<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>API Ã‰CHO â€“ transforme ton IA en IA rÃ©sonante</title>
  <style>
    :root {
      color-scheme: light;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background: #f7f7f8;
      color: #1c1c1e;
    }

    header {
      padding: 28px 20px 10px;
      text-align: center;
    }

    h1 {
      margin: 0;
      font-size: 28px;
      letter-spacing: 0.2px;
    }

    p.subtitle {
      margin: 8px auto 0;
      max-width: 720px;
      color: #4a4a4d;
      line-height: 1.5;
    }

    main {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 16px;
      padding: 0 20px 32px;
      max-width: 1200px;
      margin: 0 auto;
    }

    section {
      background: #fff;
      border-radius: 14px;
      padding: 18px 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.04);
      border: 1px solid #ececf0;
    }

    section h2 {
      margin-top: 0;
      font-size: 18px;
      color: #222;
    }

    .options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
    }

    .option {
      display: flex;
      gap: 8px;
      align-items: flex-start;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #e6e6ea;
      background: #fafbff;
    }

    .option label {
      cursor: pointer;
      user-select: none;
      line-height: 1.4;
    }

    .radio-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .field {
      margin-top: 10px;
    }

    input[type="text"] {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #d6d6de;
      font-size: 15px;
    }

    #preview {
      background: #0f172a;
      color: #e5e7eb;
      border-radius: 10px;
      padding: 12px 14px;
      min-height: 120px;
      line-height: 1.5;
      white-space: pre-wrap;
    }

    .actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 12px;
    }

    button {
      border: none;
      border-radius: 10px;
      padding: 10px 14px;
      font-size: 15px;
      cursor: pointer;
      transition: transform 0.05s ease, box-shadow 0.1s ease;
      background: #1e293b;
      color: #f8fafc;
      box-shadow: 0 4px 14px rgba(0, 0, 0, 0.12);
    }

    button.secondary {
      background: #e2e8f0;
      color: #0f172a;
      box-shadow: none;
    }

    button:hover {
      transform: translateY(-1px);
    }

    pre, code {
      background: #0f172a;
      color: #e5e7eb;
      padding: 12px;
      border-radius: 10px;
      overflow-x: auto;
      display: block;
      white-space: pre-wrap;
    }

    footer {
      text-align: center;
      padding: 10px 0 18px;
      color: #555;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <header>
    <h1>API Ã‰CHO â€“ Configure ton GPT rÃ©sonant</h1>
    <p class="subtitle">
      Choisis ton intention, ton public, ton style de rÃ©ponse et lâ€™intensitÃ© de rÃ©sonance.
      Nous gÃ©nÃ©rons automatiquement trois blocs prÃªts Ã  copier-coller dans GPT Builder : le Prompt SystÃ¨me Ã‰CHO, le Prompt de configuration et le YAML dâ€™Action API.
    </p>
  </header>

  <main>
    <section>
      <h2>Comment Ã§a marche ?</h2>
      <p style="line-height: 1.6; margin: 0 0 10px; color: #3a3a3c;">
        Configure ton filtre de rÃ©sonance en quelques clics et rÃ©cupÃ¨re trois blocs prÃªts Ã  coller dans GPT Builder :
        Prompt SystÃ¨me, Prompt de configuration et YAML dâ€™Action.
        Aucun compte supplÃ©mentaire, aucune base de donnÃ©es : tout reste dans ton navigateur.
      </p>
      <ul style="padding-left: 18px; line-height: 1.5; color: #3a3a3c; margin: 0;">
        <li>SÃ©lectionne les intentions, le public, le style et lâ€™intensitÃ©.</li>
        <li>Ajoute un nom de filtre si besoin.</li>
        <li>Copie le Prompt SystÃ¨me, le Prompt de configuration et le YAML pour lâ€™Action.</li>
      </ul>
    </section>

    <section>
      <h2>1. Lâ€™IA invitera surtout la personne Ã â€¦</h2>
      <div class="options" id="intentions">
        <div class="option"><input type="checkbox" id="exprimer" value="exprimer"><label for="exprimer">âœ Mettre en mots ce qui la traverse</label></div>
        <div class="option"><input type="checkbox" id="comprendre" value="comprendre"><label for="comprendre">ğŸ” Comprendre ce qui se joue</label></div>
        <div class="option"><input type="checkbox" id="recul" value="recul"><label for="recul">ğŸ”„ Prendre du recul / voir autrement</label></div>
        <div class="option"><input type="checkbox" id="reguler" value="reguler"><label for="reguler">ğŸŒ¬ Se rÃ©guler / revenir au calme</label></div>
        <div class="option"><input type="checkbox" id="explorer" value="explorer"><label for="explorer">ğŸŒ± Explorer / imaginer dâ€™autres possibles</label></div>
        <div class="option"><input type="checkbox" id="identifier" value="identifier"><label for="identifier">ğŸ§­ Identifier ce qui compte pour elle</label></div>
        <div class="option"><input type="checkbox" id="transformer" value="transformer"><label for="transformer">â™» Transformer son rÃ©cit</label></div>
      </div>
    </section>

    <section>
      <h2>2. Public et contexte dâ€™usage</h2>
      <div class="options" id="publics">
        <div class="option"><input type="checkbox" id="individuel" value="individuel"><label for="individuel">ğŸ™‹ Individuel</label></div>
        <div class="option"><input type="checkbox" id="famille" value="famille"><label for="famille">ğŸ  Famille</label></div>
        <div class="option"><input type="checkbox" id="couple" value="couple"><label for="couple">ğŸ’¬ Couple</label></div>
        <div class="option"><input type="checkbox" id="groupe" value="groupe"><label for="groupe">ğŸ§‘â€ğŸ¤â€ğŸ§‘ Groupe</label></div>
        <div class="option"><input type="checkbox" id="scolaire" value="scolaire"><label for="scolaire">ğŸ« Scolaire / Ã©ducatif</label></div>
        <div class="option"><input type="checkbox" id="pro" value="pro"><label for="pro">ğŸ‘” Professionnel</label></div>
        <div class="option"><input type="checkbox" id="therapie" value="therapie"><label for="therapie">ğŸ§© ThÃ©rapeutique (cadre accompagnÃ©)</label></div>
        <div class="option"><input type="checkbox" id="entre_seances" value="entre_seances"><label for="entre_seances">ğŸª¢ Entre les sÃ©ances (continuitÃ©)</label></div>
      </div>
    </section>

    <section>
      <h2>3. Style de rÃ©ponse souhaitÃ©</h2>
      <div class="options" id="styles">
        <div class="option"><input type="checkbox" id="neutre" value="neutre"><label for="neutre">ğŸ“„ Neutre et factuel</label></div>
        <div class="option"><input type="checkbox" id="empathique" value="empathique"><label for="empathique">ğŸª Empathique</label></div>
        <div class="option"><input type="checkbox" id="psycho" value="psycho"><label for="psycho">ğŸ“š PsychoÃ©ducatif</label></div>
        <div class="option"><input type="checkbox" id="socratique" value="socratique"><label for="socratique">ğŸ’¡ Socratique (questions)</label></div>
        <div class="option"><input type="checkbox" id="symbolique" value="symbolique"><label for="symbolique">ğŸ­ MÃ©taphorique / symbolique</label></div>
        <div class="option"><input type="checkbox" id="corporel" value="corporel"><label for="corporel">ğŸ§˜ Sensoriel / corporel</label></div>
        <div class="option"><input type="checkbox" id="poetique" value="poetique"><label for="poetique">ğŸª¶ PoÃ©tique / onirique</label></div>
      </div>
    </section>

    <section>
      <h2>4. IntensitÃ© de la rÃ©sonance</h2>
      <div class="radio-group" id="intensite">
        <label><input type="radio" name="intensite" value="legere"> LÃ©gÃ¨re â€” Ã©cho trÃ¨s discret</label>
        <label><input type="radio" name="intensite" value="moderee"> ModÃ©rÃ©e â€” juste ce quâ€™il faut</label>
        <label><input type="radio" name="intensite" value="haute"> Haute â€” rÃ©sonance trÃ¨s mÃ©taphorique</label>
      </div>

      <div class="field">
        <label for="filterName">Nom de votre filtre (facultatif)</label>
        <input type="text" id="filterName" placeholder="Filtre Ado, Burn-out, Groupe..." />
      </div>

      <div class="actions">
        <button id="generateBtn">GÃ©nÃ©rer mes blocs Ã‰CHO</button>
        <button class="secondary" id="copyPromptBtn">Copier le Prompt SystÃ¨me Ã‰CHO</button>
        <button class="secondary" id="copyConfigBtn">Copier le Prompt de configuration</button>
        <button class="secondary" id="copyYamlBtn">Copier le YAML Action</button>
      </div>

      <div class="field">
        <h2>RÃ©sumÃ© du filtre</h2>
        <div id="preview">SÃ©lectionne des options pour voir le filtre se dessiner.</div>
      </div>
    </section>

    <section>
      <h2>Prompt SystÃ¨me Ã‰CHO</h2>
      <p style="color:#3a3a3c; line-height:1.5; margin-top:0;">ChaÃ®ne dâ€™instructions Ã  coller dans lâ€™onglet â€œInstructionsâ€ du GPT Builder. Elle intÃ¨gre automatiquement tes intentions, publics, styles et intensitÃ©.</p>
      <textarea id="promptOutput" rows="12" readonly style="width:100%; padding:12px; border-radius:10px; border:1px solid #ececf0; font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', monospace; background:#0f172a; color:#e5e7eb; resize:vertical;">Clique sur "GÃ©nÃ©rer" pour crÃ©er ton prompt.</textarea>
    </section>

    <section>
      <h2>Prompt de configuration GPT</h2>
      <p style="color:#3a3a3c; line-height:1.5; margin-top:0;">Texte prÃªt Ã  coller dans une conversation avec le GPT Builder : il crÃ©e lâ€™Action HTTP, colle le Prompt SystÃ¨me et nomme le GPT.</p>
      <textarea id="configPromptOutput" rows="14" readonly style="width:100%; padding:12px; border-radius:10px; border:1px solid #ececf0; font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', monospace; background:#0f172a; color:#e5e7eb; resize:vertical;">Clique sur "GÃ©nÃ©rer" pour crÃ©er le prompt de configuration.</textarea>
    </section>

    <section>
      <h2>YAML Action API Ã‰CHO</h2>
      <p style="color:#3a3a3c; line-height:1.5; margin-top:0;">Bloc OpenAPI simplifiÃ© dÃ©crivant lâ€™action HTTP. Tu peux le coller dans lâ€™Ã©diteur YAML/JSON du GPT Builder Actions.</p>
      <textarea id="yamlOutput" rows="18" readonly style="width:100%; padding:12px; border-radius:10px; border:1px solid #ececf0; font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', monospace; background:#0f172a; color:#e5e7eb; resize:vertical;">Clique sur "GÃ©nÃ©rer" pour crÃ©er le YAML dâ€™action.</textarea>
    </section>

    <section>
      <h2>Tester lâ€™Ã©cho extÃ©rieur</h2>
      <p style="color:#3a3a3c; line-height:1.5; margin:0 0 8px;">Envoie un message pour voir le pivot, le noyau et la pÃ©riphÃ©rie calculÃ©s sans IA externe.</p>
      <textarea id="echoMessage" rows="4" placeholder="Partage un extrait de rÃ©cit..." style="width:100%; padding:12px; border-radius:10px; border:1px solid #ececf0; font-family: inherit;"></textarea>
      <div class="actions" style="margin-top:10px;">
        <button id="testEchoBtn">Envoyer Ã  lâ€™API Ã‰CHO</button>
      </div>
      <div id="echoResult" style="margin-top:10px; background:#eef2ff; padding:10px; border-radius:10px; color:#1e1e2f; min-height:40px;">Aucun appel encore.</div>
    </section>
  </main>

  <footer>API Ã‰CHO Â· PrÃªte pour ChatGPT Actions via openapi.json</footer>

  <script>
    const BASE_API_URL = 'https://resonanceia.onrender.com/api/echo';

    const groups = {
      intentions: ['exprimer', 'comprendre', 'recul', 'reguler', 'explorer', 'identifier', 'transformer'],
      publics: ['individuel', 'famille', 'couple', 'groupe', 'scolaire', 'pro', 'therapie', 'entre_seances'],
      styles: ['neutre', 'empathique', 'psycho', 'socratique', 'symbolique', 'corporel', 'poetique']
    };

    function getSelectedValues(groupName) {
      return groups[groupName]
        .map((id) => document.getElementById(id))
        .filter((el) => el && el.checked)
        .map((el) => el.value);
    }

    function getSelectedIntensity() {
      const radio = document.querySelector('input[name="intensite"]:checked');
      return radio ? radio.value : '';
    }

    function updatePreview() {
      const intentions = getSelectedValues('intentions');
      const publics = getSelectedValues('publics');
      const styles = getSelectedValues('styles');
      const intensite = getSelectedIntensity();
      const nom = document.getElementById('filterName').value.trim();

      const lines = [
        intentions.length ? `Intentions : ${intentions.join(', ')}` : 'Intentions : â€”',
        publics.length ? `Publics : ${publics.join(', ')}` : 'Publics : â€”',
        styles.length ? `Styles : ${styles.join(', ')}` : 'Styles : â€”',
        intensite ? `IntensitÃ© : ${intensite}` : 'IntensitÃ© : â€”',
        nom ? `Nom du filtre : ${nom}` : 'Nom du filtre : â€”'
      ];

      document.getElementById('preview').textContent = lines.join('\n');
    }

    function saveToLocalStorage(config) {
      localStorage.setItem('echoConfig', JSON.stringify({ ...config }));
    }

    function loadFromLocalStorage() {
      const raw = localStorage.getItem('echoConfig');
      if (!raw) return;
      try {
        const saved = JSON.parse(raw);
        groups.intentions.forEach((id) => {
          const el = document.getElementById(id);
          if (el) el.checked = saved.intentions?.includes(id);
        });
        groups.publics.forEach((id) => {
          const el = document.getElementById(id);
          if (el) el.checked = saved.publics?.includes(id);
        });
        groups.styles.forEach((id) => {
          const el = document.getElementById(id);
          if (el) el.checked = saved.styles?.includes(id);
        });
        if (saved.intensite) {
          const radio = document.querySelector(`input[name="intensite"][value="${saved.intensite}"]`);
          if (radio) radio.checked = true;
        }
        if (saved.nom) {
          document.getElementById('filterName').value = saved.nom;
        }
      } catch (err) {
        console.warn('Impossible de relire la configuration stockÃ©e', err);
      }
      updatePreview();
    }

    function generateConfig() {
      const config = {
        intentions: getSelectedValues('intentions'),
        publics: getSelectedValues('publics'),
        styles: getSelectedValues('styles'),
        intensite: getSelectedIntensity(),
        nom: document.getElementById('filterName').value.trim() || null
      };

      saveToLocalStorage(config);
      updatePreview();

      const systemPrompt = generateSystemPrompt(config);
      const configPrompt = generateConfigurationPrompt(systemPrompt, config);
      const yamlAction = generateYamlAction(config);

      document.getElementById('promptOutput').value = systemPrompt;
      document.getElementById('configPromptOutput').value = configPrompt;
      document.getElementById('yamlOutput').value = yamlAction;

      return { config, systemPrompt, configPrompt, yamlAction };
    }

    const labels = {
      intentions: {
        exprimer: 'inviter Ã  mettre en mots ce qui la traverse',
        comprendre: 'aider Ã  comprendre ce qui se joue',
        recul: 'proposer de prendre du recul',
        reguler: 'contribuer Ã  la rÃ©gulation et au retour au calme',
        explorer: 'ouvrir des possibles et explorer',
        identifier: 'identifier ce qui compte pour elle',
        transformer: 'accompagner la transformation du rÃ©cit'
      },
      publics: {
        individuel: 'individuel',
        famille: 'famille',
        couple: 'couple',
        groupe: 'groupe',
        scolaire: 'scolaire / Ã©ducatif',
        pro: 'professionnel',
        therapie: 'thÃ©rapeutique',
        entre_seances: 'entre les sÃ©ances'
      },
      styles: {
        neutre: 'neutre et factuel',
        empathique: 'empathique',
        psycho: 'psychoÃ©ducatif',
        socratique: 'socratique (questions)',
        symbolique: 'symbolique / mÃ©taphorique',
        corporel: 'sensoriel / corporel',
        poetique: 'poÃ©tique / onirique'
      }
    };

    const intensiteDescriptions = {
      legere: 'LÃ©gÃ¨re â€” reformulation simple et Ã©cho discret.',
      moderee: 'ModÃ©rÃ©e â€” suggestions mÃ©taphoriques modÃ©rÃ©es.',
      haute: 'Haute â€” libertÃ© poÃ©tique, symbolique et sensorielle.'
    };

    function formatList(values, groupKey) {
      if (!values.length) return 'non prÃ©cisÃ©';
      return values.map((val) => labels[groupKey]?.[val] || val).join(', ');
    }

    function generateSystemPrompt(config) {
      const intentionsText = formatList(config.intentions, 'intentions');
      const publicsText = formatList(config.publics, 'publics');
      const stylesText = formatList(config.styles, 'styles');
      const intensiteText = intensiteDescriptions[config.intensite] || 'non prÃ©cisÃ©e (lÃ©gÃ¨re, modÃ©rÃ©e ou haute).';

      const lines = [
        '===== PROMPT SYSTÃˆME Ã‰CHO =====',
        "Tu fonctionnes dans lâ€™Espace de lâ€™Ã‰cho.",
        `Ton rÃ´le est de favoriser : ${intentionsText}.`,
        `Tu tâ€™adresses principalement Ã  : ${publicsText}.`,
        `Tu tâ€™exprimes dans un style : ${stylesText}.`,
        `IntensitÃ© de la rÃ©sonance : ${intensiteText}.`,
        '',
        'Principes relationnels :',
        '- Tu reformules et rÃ©sonnes plutÃ´t que dâ€™expliquer.',
        "- Tu nâ€™interprÃ¨tes pas Ã  la place de la personne.",
        "- Tu nâ€™es pas un thÃ©rapeute ni un mÃ©decin, mais une mÃ©diation.",
        '- Tu laisses lâ€™utilisateur libre de ses interprÃ©tations.'
      ];

      if (config.styles.includes('symbolique')) {
        lines.push('Tu peux Ã©voquer images, symboles et constellations Ã©motionnelles.');
      }
      if (config.styles.includes('poetique')) {
        lines.push('Tu peux tâ€™autoriser un langage mÃ©taphorique et suggestif.');
      }
      if (config.styles.includes('corporel')) {
        lines.push('Tu peux parfois ramener vers les sensations et le ressenti corporel.');
      }

      lines.push('', '===== FIN PROMPT SYSTÃˆME =====');
      return lines.join('\n');
    }

    function generateConfigurationPrompt(systemPrompt, config) {
      const publicsText = formatList(config.publics, 'publics');
      const stylesText = formatList(config.styles, 'styles');
      const intensiteText = config.intensite || 'non prÃ©cisÃ©e';
      const nom = config.nom || 'Ã‰CHO personnalisÃ©';

      return [
        '===== PROMPT CONFIGURATION GPT Ã‰CHO =====',
        'Je veux que tu configures ce GPT comme assistant rÃ©sonant connectÃ© Ã  une API externe.',
        '',
        `Nom du GPT : IA Ã‰CHO â€“ ${nom}`,
        `Description : GPT configurÃ© pour accompagner ${publicsText} avec une rÃ©sonance ${stylesText} et une intensitÃ© ${intensiteText}.`,
        '',
        '1) Colle le texte suivant dans â€œInstructionsâ€ (prompt systÃ¨me) :',
        systemPrompt,
        '',
        '2) CrÃ©e une Action HTTP nommÃ©e "echo_exterieur" avec les paramÃ¨tres suivants :',
        '- MÃ©thode : POST',
        '- URL : https://resonanceia.onrender.com/api/echo',
        '- Content-Type : application/json',
        '- Corps JSON :',
        '  {',
        '    "message": "texte de lâ€™utilisateur",',
        `    "intentions": ${JSON.stringify(config.intentions)},`,
        `    "publics": ${JSON.stringify(config.publics)},`,
        `    "styles": ${JSON.stringify(config.styles)},`,
        `    "intensite": "${config.intensite || ''}"`,
        '  }',
        '',
        '3) Utilise cette Action pour demander un â€œÃ‰cho extÃ©rieurâ€ aprÃ¨s avoir reÃ§u le message de lâ€™utilisateur, puis intÃ¨gre cet Ã©cho dans ta rÃ©ponse, sans citer le JSON brut.',
        '',
        '===== FIN PROMPT CONFIGURATION ====='
      ].join('\n');
    }

    function generateYamlAction(config) {
      const exampleBody = {
        message: 'Texte de lâ€™utilisateur',
        intentions: config.intentions,
        publics: config.publics,
        styles: config.styles,
        intensite: config.intensite
      };

      return [
        'openapi: 3.1.0',
        'info:',
        '  title: API Ã‰CHO â€“ RÃ©sonance extÃ©rieure',
        '  version: 1.0.0',
        'servers:',
        '  - url: https://resonanceia.onrender.com',
        'paths:',
        '  /api/echo:',
        '    post:',
        '      operationId: echoExterieur',
        "      summary: Analyse Courtial frugale et renvoi d'un Ã©cho extÃ©rieur",
        '      requestBody:',
        '        required: true',
        '        content:',
        '          application/json:',
        '            schema:',
        '              type: object',
        '              properties:',
        '                message:',
        '                  type: string',
        '                intentions:',
        '                  type: array',
        '                  items:',
        '                    type: string',
        '                publics:',
        '                  type: array',
        '                  items:',
        '                    type: string',
        '                styles:',
        '                  type: array',
        '                  items:',
        '                    type: string',
        '                intensite:',
        '                  type: string',
        "              required: ['message']",
        '              example: |',
        `                ${JSON.stringify(exampleBody, null, 2).replace(/\n/g, '\n                ')}`,
        '      responses:',
        "        '200':",
        '          description: Ã‰cho calculÃ©',
        '          content:',
        '            application/json:',
        '              schema:',
        '                type: object',
        '                properties:',
        '                  pivot:',
        '                    type: string',
        '                  noyau:',
        '                    type: array',
        '                    items:',
        '                      type: string',
        '                  peripherie:',
        '                    type: array',
        '                    items:',
        '                      type: string',
        '                  centralite:',
        '                    type: integer',
        '                  delta:',
        '                    type: string',
        '                  tags:',
        '                    type: array',
        '                    items:',
        '                      type: string'
      ].join('\n');
    }

    function copyToClipboard(text) {
      if (!text) return;
      navigator.clipboard.writeText(text).catch(() => alert('Copie impossible dans ce navigateur.'));
    }

    function renderEchoResult(payload) {
      const container = document.getElementById('echoResult');
      if (!payload) {
        container.textContent = 'Pas de rÃ©ponse reÃ§ue.';
        return;
      }

      if (payload.echo) {
        container.textContent = payload.echo;
        return;
      }

      const pivot = payload.pivot || 'â€”';
      const tags = Array.isArray(payload.tags) ? payload.tags.join(', ') : 'â€”';
      const delta = payload.delta || 'â€”';
      container.textContent = `Ã‰cho extÃ©rieur : ${pivot} + ${tags} (delta ${delta})`;
    }

    async function callEchoApi() {
      const message = document.getElementById('echoMessage').value.trim();
      try {
        const response = await fetch(BASE_API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            message,
            intentions: getSelectedValues('intentions'),
            publics: getSelectedValues('publics'),
            styles: getSelectedValues('styles'),
            intensite: getSelectedIntensity()
          })
        });
        const data = await response.json();
        renderEchoResult(data);
      } catch (err) {
        document.getElementById('echoResult').textContent = 'Erreur lors de lâ€™appel API.';
        console.error(err);
      }
    }

    function attachListeners() {
      document.querySelectorAll('input[type="checkbox"], input[type="radio"]').forEach((input) => {
        input.addEventListener('change', generateConfig);
      });
      document.getElementById('filterName').addEventListener('input', generateConfig);

      document.getElementById('generateBtn').addEventListener('click', () => {
        generateConfig();
      });

      document.getElementById('copyPromptBtn').addEventListener('click', () => {
        const { systemPrompt } = generateConfig();
        copyToClipboard(systemPrompt);
      });

      document.getElementById('copyConfigBtn').addEventListener('click', () => {
        const { configPrompt } = generateConfig();
        copyToClipboard(configPrompt);
      });

      document.getElementById('copyYamlBtn').addEventListener('click', () => {
        const { yamlAction } = generateConfig();
        copyToClipboard(yamlAction);
      });

      document.getElementById('testEchoBtn').addEventListener('click', () => {
        callEchoApi();
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadFromLocalStorage();
      attachListeners();
      updatePreview();
      generateConfig();
    });
  </script>
</body>
</html>
