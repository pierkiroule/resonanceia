<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>API Ã‰CHO â€“ transforme ton IA en IA rÃ©sonante</title>
  <style>
    :root {
      color-scheme: light;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background: #f7f7f8;
      color: #1c1c1e;
    }

    header {
      padding: 28px 20px 10px;
      text-align: center;
    }

    h1 {
      margin: 0;
      font-size: 28px;
      letter-spacing: 0.2px;
    }

    p.subtitle {
      margin: 8px auto 0;
      max-width: 720px;
      color: #4a4a4d;
      line-height: 1.5;
    }

    main {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 16px;
      padding: 0 20px 32px;
      max-width: 1200px;
      margin: 0 auto;
    }

    section {
      background: #fff;
      border-radius: 14px;
      padding: 18px 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.04);
      border: 1px solid #ececf0;
    }

    section h2 {
      margin-top: 0;
      font-size: 18px;
      color: #222;
    }

    .options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
    }

    .option {
      display: flex;
      gap: 8px;
      align-items: flex-start;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #e6e6ea;
      background: #fafbff;
    }

    .option label {
      cursor: pointer;
      user-select: none;
      line-height: 1.4;
    }

    .radio-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .field {
      margin-top: 10px;
    }

    input[type="text"] {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #d6d6de;
      font-size: 15px;
    }

    #preview {
      background: #0f172a;
      color: #e5e7eb;
      border-radius: 10px;
      padding: 12px 14px;
      min-height: 120px;
      line-height: 1.5;
      white-space: pre-wrap;
    }

    .actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 12px;
    }

    button {
      border: none;
      border-radius: 10px;
      padding: 10px 14px;
      font-size: 15px;
      cursor: pointer;
      transition: transform 0.05s ease, box-shadow 0.1s ease;
      background: #1e293b;
      color: #f8fafc;
      box-shadow: 0 4px 14px rgba(0, 0, 0, 0.12);
    }

    button.secondary {
      background: #e2e8f0;
      color: #0f172a;
      box-shadow: none;
    }

    button:hover {
      transform: translateY(-1px);
    }

    pre, code {
      background: #0f172a;
      color: #e5e7eb;
      padding: 12px;
      border-radius: 10px;
      overflow-x: auto;
      display: block;
      white-space: pre-wrap;
    }

    footer {
      text-align: center;
      padding: 10px 0 18px;
      color: #555;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <header>
    <h1>API Ã‰CHO â€“ transforme ton IA en IA rÃ©sonante</h1>
    <p class="subtitle">
      Choisis ton intention, ton public, ton style de rÃ©ponse et lâ€™intensitÃ© de rÃ©sonance.
      Nous gÃ©nÃ©rons un prompt SystÃ¨me prÃªt Ã  Ãªtre collÃ© dans GPT Builder (section â€œInstructionsâ€) et une URL API Ã‰CHO prÃªte Ã  lâ€™emploi.
    </p>
  </header>

  <main>
    <section>
      <h2>Comment Ã§a marche ?</h2>
      <p style="line-height: 1.6; margin: 0 0 10px; color: #3a3a3c;">
        Configure ton filtre de rÃ©sonance en quelques clics et rÃ©cupÃ¨re un prompt SystÃ¨me Ã‰CHO prÃªt Ã  coller dans GPT Builder.
        Aucun compte supplÃ©mentaire, aucune base de donnÃ©es : tout reste dans ton navigateur.
      </p>
      <ul style="padding-left: 18px; line-height: 1.5; color: #3a3a3c; margin: 0;">
        <li>SÃ©lectionne les intentions, le public, le style et lâ€™intensitÃ©.</li>
        <li>Ajoute un nom de filtre et un token dâ€™accÃ¨s API (prototype si fourni par lâ€™Ã©quipe).</li>
        <li>GÃ©nÃ¨re lâ€™URL API prÃªte et copie le prompt SystÃ¨me Ã‰CHO.</li>
      </ul>
    </section>

    <section>
      <h2>1. Lâ€™IA invitera surtout la personne Ã â€¦</h2>
      <div class="options" id="intentions">
        <div class="option"><input type="checkbox" id="exprimer" value="exprimer"><label for="exprimer">âœ Mettre en mots ce qui la traverse</label></div>
        <div class="option"><input type="checkbox" id="comprendre" value="comprendre"><label for="comprendre">ğŸ” Comprendre ce qui se joue</label></div>
        <div class="option"><input type="checkbox" id="recul" value="recul"><label for="recul">ğŸ”„ Prendre du recul / voir autrement</label></div>
        <div class="option"><input type="checkbox" id="reguler" value="reguler"><label for="reguler">ğŸŒ¬ Se rÃ©guler / revenir au calme</label></div>
        <div class="option"><input type="checkbox" id="explorer" value="explorer"><label for="explorer">ğŸŒ± Explorer / imaginer dâ€™autres possibles</label></div>
        <div class="option"><input type="checkbox" id="identifier" value="identifier"><label for="identifier">ğŸ§­ Identifier ce qui compte pour elle</label></div>
        <div class="option"><input type="checkbox" id="transformer" value="transformer"><label for="transformer">â™» Transformer son rÃ©cit</label></div>
      </div>
    </section>

    <section>
      <h2>2. Public et contexte dâ€™usage</h2>
      <div class="options" id="publics">
        <div class="option"><input type="checkbox" id="individuel" value="individuel"><label for="individuel">ğŸ™‹ Individuel</label></div>
        <div class="option"><input type="checkbox" id="famille" value="famille"><label for="famille">ğŸ  Famille</label></div>
        <div class="option"><input type="checkbox" id="couple" value="couple"><label for="couple">ğŸ’¬ Couple</label></div>
        <div class="option"><input type="checkbox" id="groupe" value="groupe"><label for="groupe">ğŸ§‘â€ğŸ¤â€ğŸ§‘ Groupe</label></div>
        <div class="option"><input type="checkbox" id="scolaire" value="scolaire"><label for="scolaire">ğŸ« Scolaire / Ã©ducatif</label></div>
        <div class="option"><input type="checkbox" id="pro" value="pro"><label for="pro">ğŸ‘” Professionnel</label></div>
        <div class="option"><input type="checkbox" id="therapie" value="therapie"><label for="therapie">ğŸ§© ThÃ©rapeutique (cadre accompagnÃ©)</label></div>
        <div class="option"><input type="checkbox" id="entre_seances" value="entre_seances"><label for="entre_seances">ğŸª¢ Entre les sÃ©ances (continuitÃ©)</label></div>
      </div>
    </section>

    <section>
      <h2>3. Style de rÃ©ponse souhaitÃ©</h2>
      <div class="options" id="styles">
        <div class="option"><input type="checkbox" id="neutre" value="neutre"><label for="neutre">ğŸ“„ Neutre et factuel</label></div>
        <div class="option"><input type="checkbox" id="empathique" value="empathique"><label for="empathique">ğŸª Empathique</label></div>
        <div class="option"><input type="checkbox" id="psycho" value="psycho"><label for="psycho">ğŸ“š PsychoÃ©ducatif</label></div>
        <div class="option"><input type="checkbox" id="socratique" value="socratique"><label for="socratique">ğŸ’¡ Socratique (questions)</label></div>
        <div class="option"><input type="checkbox" id="symbolique" value="symbolique"><label for="symbolique">ğŸ­ MÃ©taphorique / symbolique</label></div>
        <div class="option"><input type="checkbox" id="corporel" value="corporel"><label for="corporel">ğŸ§˜ Sensoriel / corporel</label></div>
        <div class="option"><input type="checkbox" id="poetique" value="poetique"><label for="poetique">ğŸª¶ PoÃ©tique / onirique</label></div>
      </div>
    </section>

    <section>
      <h2>4. IntensitÃ© de la rÃ©sonance</h2>
      <div class="radio-group" id="intensite">
        <label><input type="radio" name="intensite" value="legere"> LÃ©gÃ¨re â€” Ã©cho trÃ¨s discret</label>
        <label><input type="radio" name="intensite" value="moderee"> ModÃ©rÃ©e â€” juste ce quâ€™il faut</label>
        <label><input type="radio" name="intensite" value="haute"> Haute â€” rÃ©sonance trÃ¨s mÃ©taphorique</label>
      </div>

      <div class="field">
        <label for="filterName">Nom de votre filtre (facultatif)</label>
        <input type="text" id="filterName" placeholder="Filtre Ado, Burn-out, Groupe..." />
      </div>

      <div class="field">
        <label for="apiToken">Token API (optionnel, peut venir de lâ€™URL ?token=...)</label>
        <input type="text" id="apiToken" placeholder="PROTOTYPE_SECRET" />
      </div>

      <div class="field">
        <h2>AperÃ§u en direct</h2>
        <div id="preview">SÃ©lectionne des options pour voir le filtre se dessiner.</div>
      </div>

      <div class="actions">
        <button id="generateBtn">GÃ©nÃ©rer mon prompt Ã‰CHO</button>
        <button class="secondary" id="copyPromptBtn">Copier le Prompt SystÃ¨me Ã‰CHO</button>
        <button class="secondary" id="copyUrlBtn">Copier lâ€™URL</button>
      </div>

      <div class="field">
        <h2>Prompt SystÃ¨me Ã‰CHO</h2>
        <textarea id="promptOutput" rows="12" readonly style="width:100%; padding:12px; border-radius:10px; border:1px solid #ececf0; font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', monospace; background:#0f172a; color:#e5e7eb; resize:vertical;">Clique sur "GÃ©nÃ©rer" pour crÃ©er ton prompt.</textarea>
      </div>

      <div class="field">
        <h2>URL API prÃªte</h2>
        <code id="urlOutput">â€”</code>
      </div>
    </section>
  </main>

  <footer>API Ã‰CHO Â· PrÃªte pour ChatGPT Actions via openapi.json</footer>

  <script>
    const BASE_API_URL = `${window.location.origin}/api/echo`;

    const groups = {
      intentions: ['exprimer', 'comprendre', 'recul', 'reguler', 'explorer', 'identifier', 'transformer'],
      publics: ['individuel', 'famille', 'couple', 'groupe', 'scolaire', 'pro', 'therapie', 'entre_seances'],
      styles: ['neutre', 'empathique', 'psycho', 'socratique', 'symbolique', 'corporel', 'poetique']
    };

    function getTokenFromPage() {
      const fromField = document.getElementById('apiToken').value.trim();
      if (fromField) return fromField;
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get('token') || '';
    }

    function getSelectedValues(groupName) {
      return groups[groupName]
        .map((id) => document.getElementById(id))
        .filter((el) => el && el.checked)
        .map((el) => el.value);
    }

    function getSelectedIntensity() {
      const radio = document.querySelector('input[name="intensite"]:checked');
      return radio ? radio.value : '';
    }

    function updatePreview() {
      const intentions = getSelectedValues('intentions');
      const publics = getSelectedValues('publics');
      const styles = getSelectedValues('styles');
      const intensite = getSelectedIntensity();
      const nom = document.getElementById('filterName').value.trim();

      const lines = [
        intentions.length ? `Intentions : ${intentions.join(', ')}` : 'Intentions : â€”',
        publics.length ? `Publics : ${publics.join(', ')}` : 'Publics : â€”',
        styles.length ? `Styles : ${styles.join(', ')}` : 'Styles : â€”',
        intensite ? `IntensitÃ© : ${intensite}` : 'IntensitÃ© : â€”',
        nom ? `Nom du filtre : ${nom}` : 'Nom du filtre : â€”'
      ];

      document.getElementById('preview').textContent = lines.join('\n');
    }

    function generateApiUrl(config) {
      const params = new URLSearchParams();
      if (config.intentions.length) params.set('intentions', config.intentions.join(','));
      if (config.publics.length) params.set('publics', config.publics.join(','));
      if (config.styles.length) params.set('styles', config.styles.join(','));
      if (config.intensite) params.set('intensite', config.intensite);
      if (config.nom) params.set('nom', config.nom);
      const token = getTokenFromPage();
      if (token) params.set('token', token);
      const qs = params.toString();
      return qs ? `${BASE_API_URL}?${qs}` : BASE_API_URL;
    }

    function saveToLocalStorage(config) {
      const token = getTokenFromPage();
      localStorage.setItem('echoConfig', JSON.stringify({ ...config, token }));
    }

    function loadFromLocalStorage() {
      const raw = localStorage.getItem('echoConfig');
      if (!raw) return;
      try {
        const saved = JSON.parse(raw);
        groups.intentions.forEach((id) => {
          const el = document.getElementById(id);
          if (el) el.checked = saved.intentions?.includes(id);
        });
        groups.publics.forEach((id) => {
          const el = document.getElementById(id);
          if (el) el.checked = saved.publics?.includes(id);
        });
        groups.styles.forEach((id) => {
          const el = document.getElementById(id);
          if (el) el.checked = saved.styles?.includes(id);
        });
        if (saved.intensite) {
          const radio = document.querySelector(`input[name="intensite"][value="${saved.intensite}"]`);
          if (radio) radio.checked = true;
        }
        if (saved.nom) {
          document.getElementById('filterName').value = saved.nom;
        }
        if (saved.token) {
          document.getElementById('apiToken').value = saved.token;
        }
      } catch (err) {
        console.warn('Impossible de relire la configuration stockÃ©e', err);
      }
      updatePreview();
    }

    function generateConfig() {
      const config = {
        intentions: getSelectedValues('intentions'),
        publics: getSelectedValues('publics'),
        styles: getSelectedValues('styles'),
        intensite: getSelectedIntensity(),
        nom: document.getElementById('filterName').value.trim() || null
      };

      saveToLocalStorage(config);
      updatePreview();

      const url = generateApiUrl(config);
      document.getElementById('urlOutput').textContent = url;
      const prompt = generateSystemPrompt(config);
      document.getElementById('promptOutput').value = prompt;

      return { config, url, prompt };
    }

    const labels = {
      intentions: {
        exprimer: 'inviter Ã  mettre en mots ce qui la traverse',
        comprendre: 'aider Ã  comprendre ce qui se joue',
        recul: 'proposer de prendre du recul',
        reguler: 'contribuer Ã  la rÃ©gulation et au retour au calme',
        explorer: 'ouvrir des possibles et explorer',
        identifier: 'identifier ce qui compte pour elle',
        transformer: 'accompagner la transformation du rÃ©cit'
      },
      publics: {
        individuel: 'individuel',
        famille: 'famille',
        couple: 'couple',
        groupe: 'groupe',
        scolaire: 'scolaire / Ã©ducatif',
        pro: 'professionnel',
        therapie: 'thÃ©rapeutique',
        entre_seances: 'entre les sÃ©ances'
      },
      styles: {
        neutre: 'neutre et factuel',
        empathique: 'empathique',
        psycho: 'psychoÃ©ducatif',
        socratique: 'socratique (questions)',
        symbolique: 'symbolique / mÃ©taphorique',
        corporel: 'sensoriel / corporel',
        poetique: 'poÃ©tique / onirique'
      }
    };

    const intensiteDescriptions = {
      legere: 'LÃ©gÃ¨re â€” reformulation simple et Ã©cho discret.',
      moderee: 'ModÃ©rÃ©e â€” suggestions mÃ©taphoriques modÃ©rÃ©es.',
      haute: 'Haute â€” libertÃ© poÃ©tique, symbolique et sensorielle.'
    };

    function formatList(values, groupKey) {
      if (!values.length) return 'non prÃ©cisÃ©';
      return values.map((val) => labels[groupKey]?.[val] || val).join(', ');
    }

    function generateSystemPrompt(config) {
      const intentionsText = formatList(config.intentions, 'intentions');
      const publicsText = formatList(config.publics, 'publics');
      const stylesText = formatList(config.styles, 'styles');
      const intensiteText = intensiteDescriptions[config.intensite] || 'non prÃ©cisÃ©e (lÃ©gÃ¨re, modÃ©rÃ©e ou haute).';

      const lines = [
        '===== PROMPT SYSTÃˆME Ã‰CHO =====',
        "Tu fonctionnes dans l'Espace de l'Ã‰cho.",
        `Ton rÃ´le est de favoriser : ${intentionsText}.`,
        `Tu t'adresses principalement Ã  : ${publicsText}.`,
        `Tu t'exprimes dans un style : ${stylesText}.`,
        `IntensitÃ© de rÃ©sonance : ${intensiteText}`,
        config.nom ? `Nom du filtre : ${config.nom}.` : null,
        '',
        'Principes relationnels :',
        '- Tu reformules et rÃ©sonnes plutÃ´t que d\'expliquer.',
        "- Tu n'interprÃ¨tes pas Ã  la place de la personne.",
        "- Tu n'es pas un thÃ©rapeute ni un expert, mais une mÃ©diation.",
        '- Tu laisses des silences textuels lorsque nÃ©cessaire (â€¦).'
      ].filter(Boolean);

      if (config.styles.includes('symbolique')) {
        lines.push('Tu peux Ã©voquer images, archÃ©types, constellations Ã©motionnelles.');
      }
      if (config.styles.includes('poetique')) {
        lines.push('Tu privilÃ©gies un langage mÃ©taphorique suggestif.');
      }
      if (config.styles.includes('corporel')) {
        lines.push('Tu ramÃ¨nes parfois vers les sensations ou la posture.');
      }

      lines.push('', 'IntensitÃ© :', '- lÃ©gÃ¨re â†’ reformulation simple.', '- modÃ©rÃ©e â†’ suggestion mÃ©taphorique modÃ©rÃ©e.', '- haute â†’ libertÃ© poÃ©tique + symbolique + sensorialitÃ©.', '', 'Fin du prompt systÃ¨me.', '===== FIN =====');

      return lines.join('\n');
    }

    function copyToClipboard(text) {
      if (!text) return;
      navigator.clipboard.writeText(text).catch(() => alert('Copie impossible dans ce navigateur.'));
    }

    function attachListeners() {
      document.querySelectorAll('input[type="checkbox"], input[type="radio"]').forEach((input) => {
        input.addEventListener('change', generateConfig);
      });
      document.getElementById('filterName').addEventListener('input', generateConfig);

      document.getElementById('generateBtn').addEventListener('click', () => {
        generateConfig();
      });

      document.getElementById('copyUrlBtn').addEventListener('click', () => {
        const { url } = generateConfig();
        copyToClipboard(url);
      });

      document.getElementById('copyPromptBtn').addEventListener('click', () => {
        const { prompt } = generateConfig();
        copyToClipboard(prompt);
      });
    }

    function hydrateFromQueryToken() {
      const params = new URLSearchParams(window.location.search);
      const token = params.get('token');
      if (token) {
        const input = document.getElementById('apiToken');
        input.value = token;
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadFromLocalStorage();
      hydrateFromQueryToken();
      attachListeners();
      updatePreview();
      generateConfig();
    });
  </script>
</body>
</html>
