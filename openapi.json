{
  "openapi": "3.0.0",
  "info": {
    "title": "RésonancIA API",
    "version": "0.2.0",
    "description": "API d'analyse sémantique avancée et génération d'échos résonants. Analyse co-word inspirée Courtial/Callon avec mémoire douce et modes adaptatifs.",
    "contact": {
      "name": "RésonancIA Team",
      "url": "https://resonancia.dev",
      "email": "api@resonancia.dev"
    },
    "license": {
      "name": "MIT"
    },
    "x-logo": {
      "url": "https://resonancia.dev/logo.png",
      "altText": "RésonancIA Logo"
    }
  },
  "servers": [
    {
      "url": "http://localhost:3000",
      "description": "Développement local"
    },
    {
      "url": "https://resonancia-api.vercel.app",
      "description": "Production (Vercel)"
    }
  ],
  "tags": [
    {
      "name": "Echo",
      "description": "Analyse sémantique et génération d'échos résonants"
    },
    {
      "name": "Documentation",
      "description": "Informations sur l'API et garanties RGPD"
    }
  ],
  "paths": {
    "/api/echo": {
      "post": {
        "tags": ["Echo"],
        "summary": "Analyse un message et retourne un écho résonant",
        "description": "Effectue une analyse sémantique complète du message:\n- Tokenisation et fréquence\n- Co-word analysis (fenêtre glissante)\n- Identification pivot (fréquence 60% + connectivité 40%)\n- Séparation noyau/périphérie\n- Génération écho adapté au mode\n- Mise à jour mémoire douce (si activée)\n\nAucun texte complet n'est conservé, seulement la structure sémantique anonymisée.",
        "operationId": "postEcho",
        "requestBody": {
          "required": true,
          "description": "Paramètres d'analyse",
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "message": {
                    "type": "string",
                    "description": "Le texte à analyser (3-2000 caractères)",
                    "minLength": 3,
                    "maxLength": 2000
                  },
                  "mode": {
                    "type": "string",
                    "enum": ["neutral", "hypno", "ado", "etp"],
                    "default": "neutral",
                    "description": "Mode de réponse:\n- **neutral**: Équilibré, poétique, réfléchi\n- **hypno**: Apaisant, murmures, descente progressive\n- **ado**: Énergique, slang jeune, intensité\n- **etp**: Bienveillant, éducatif, enfants/ETP"
                  },
                  "disableMemory": {
                    "type": "boolean",
                    "description": "Désactive la mémoire douce pour cet appel (défaut: false). La mémoire anonymisée n'est jamais stockée au-delà de 90 jours.",
                    "default": false
                  }
                },
                "required": ["message"],
                "additionalProperties": false
              },
              "examples": {
                "neutral": {
                  "value": {
                    "message": "Je cherche du sens dans ce monde complexe",
                    "mode": "neutral"
                  }
                },
                "hypno": {
                  "value": {
                    "message": "Je cherche du sens dans ce monde complexe",
                    "mode": "hypno",
                    "disableMemory": false
                  }
                },
                "ado": {
                  "value": {
                    "message": "C'est trop cool ce truc ouf!",
                    "mode": "ado"
                  }
                },
                "etp": {
                  "value": {
                    "message": "J'aime apprendre et découvrir de nouvelles choses",
                    "mode": "etp"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Analyse sémantique complète et écho résonant généré",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["pivot", "noyau", "peripherie", "echo", "mode", "liens", "centralite"],
                  "properties": {
                    "pivot": {
                      "type": "string",
                      "description": "Mot central identifié comme pivot (plus haute fréquence + connectivité)",
                      "example": "sens"
                    },
                    "noyau": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "Mots du noyau sémantique (30% supérieur en fréquence)",
                      "example": ["monde", "complexe", "cherche"]
                    },
                    "peripherie": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "Mots de la périphérie (fréquence plus basse, détails)",
                      "example": ["ce", "je", "du"]
                    },
                    "echo": {
                      "type": "string",
                      "description": "Texte d'écho généré selon le mode (structure aléatoire contrôlée)",
                      "example": "Le cœur de votre message: sens. Cela résonne avec: monde, complexe."
                    },
                    "metaphor": {
                      "type": "string",
                      "description": "Métaphore poétique associée au contexte",
                      "example": "comme une onde qui se propage"
                    },
                    "question": {
                      "type": "string",
                      "description": "Question ouverte pour approfondissement, adaptée au mode",
                      "example": "Que porte ce mot pour vous?"
                    },
                    "liens": {
                      "type": "object",
                      "description": "Paires co-word (actant-actant) principales avec scores Courtial. Top 8 paires avec fréquence > 1",
                      "additionalProperties": {
                        "type": "number",
                        "minimum": 1
                      },
                      "example": {
                        "monde-complexe": 3,
                        "sens-monde": 2,
                        "cherche-sens": 2
                      }
                    },
                    "centralite": {
                      "type": "integer",
                      "description": "Score de centralité du pivot = nombre de liaisons distinctes (betweenness approximée)",
                      "minimum": 0,
                      "example": 5
                    },
                    "mode": {
                      "type": "string",
                      "enum": ["neutral", "hypno", "ado", "etp"],
                      "description": "Mode appliqué à la génération d'écho",
                      "example": "neutral"
                    },
                    "memoire": {
                      "type": ["string", "null"],
                      "description": "Contexte mémoire douce (null si disableMemory=true). Format: \"Le pivot X s'est manifesté N fois. Ses échos: paire1 (score1), paire2 (score2)\"",
                      "example": "Le pivot \"sens\" s'est manifesté 5 fois. Ses échos: monde-complexe (2.8), sens-monde (1.9)"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Erreur de validation (message manquant, vide, ou mode invalide)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "message is required and must be a string"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Erreur serveur interne",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Internal server error"
                    }
                  }
                }
              }
            }
          }
        },
        "x-codeSamples": [
          {
            "lang": "curl",
            "source": "curl -X POST http://localhost:3000/api/echo \\\n  -H 'Content-Type: application/json' \\\n  -d '{\"message\": \"Je cherche du sens\", \"mode\": \"neutral\"}'"
          },
          {
            "lang": "javascript",
            "source": "const response = await fetch('http://localhost:3000/api/echo', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({\n    message: 'Je cherche du sens',\n    mode: 'neutral'\n  })\n});\nconst data = await response.json();"
          },
          {
            "lang": "python",
            "source": "import requests\n\nresponse = requests.post(\n    'http://localhost:3000/api/echo',\n    json={'message': 'Je cherche du sens', 'mode': 'neutral'}\n)\ndata = response.json()"
          }
        ]
      }
    }
  },
  "components": {
    "schemas": {
      "EchoRequest": {
        "type": "object",
        "required": ["message"],
        "properties": {
          "message": {
            "type": "string",
            "minLength": 3,
            "maxLength": 2000
          },
          "mode": {
            "type": "string",
            "enum": ["neutral", "hypno", "ado", "etp"],
            "default": "neutral"
          },
          "disableMemory": {
            "type": "boolean",
            "default": false
          }
        }
      },
      "EchoResponse": {
        "type": "object",
        "required": ["pivot", "noyau", "peripherie", "echo", "mode"],
        "properties": {
          "pivot": { "type": "string" },
          "noyau": { "type": "array", "items": { "type": "string" } },
          "peripherie": { "type": "array", "items": { "type": "string" } },
          "echo": { "type": "string" },
          "metaphor": { "type": "string" },
          "question": { "type": "string" },
          "liens": { "type": "object" },
          "centralite": { "type": "integer" },
          "mode": { "type": "string" },
          "memoire": { "type": ["string", "null"] }
        }
      }
    },
    "securitySchemes": {
      "ApiKeyAuth": {
        "type": "apiKey",
        "in": "header",
        "name": "X-API-Key",
        "description": "API Key (optionnel pour dev, requis en production)"
      }
    }
  },
  "x-internal-notes": {
    "privacy": "Aucun stockage textuel. Seulement structure sémantique anonymisée (pivots, liens). Mémoire decay tous les 10 appels (0.97x). Purge automatique des liens < 0.1.",
    "rgpd": "Pas de conservation d'identifiants personnels. Données anonymisées. Droit à l'oubli: query disableMemory=true pour chaque appel.",
    "performance": "Tokenisation O(n). Co-word O(n*w²). Temps réponse < 100ms. Mémoire < 5MB (graph.json).",
    "gpt-actions": "Compatible GPT Actions. Utiliser openapi.json directement dans Configure Actions."
  }
}
