<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>üåÄ IA R√©sonante</title>
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <header>
    <h1>üåÄ IA R√©sonante</h1>
    <p>Un espace pour d√©poser, √©couter, r√©sonner. Interface de d√©monstration reli√©e √† Nebius Studio.</p>
  </header>

  <section class="panel" aria-label="Conversation">
    <h3>Conversation</h3>
    <div class="history" id="history"></div>
    <div class="small" id="status">Pr√™t √† dialoguer (mod√®le Qwen/Qwen3-32B).</div>
    <div class="toggle-row" role="group" aria-label="Bascule Nebius ou simulation">
      <span class="small">Mode API</span>
      <button id="modeToggle" class="toggle" type="button" aria-pressed="false" title="Basculer entre MOCK et Nebius">
        <span class="toggle-label">MOCK</span>
        <span class="toggle-handle" aria-hidden="true"></span>
        <span class="toggle-label">NEBIUS</span>
      </button>
      <span class="small" id="dataMode">Mode API: ‚Äî</span>
    </div>
    <div class="row dense" aria-label="R√©glages de r√©sonance">
      <div>
        <label for="resonanceMode">Mode de formulation</label>
        <div id="resonanceMode" class="pill-group" role="group" aria-label="Mode de formulation">
          <button type="button" class="pill is-active" data-mode="raw">Chat brut</button>
          <button type="button" class="pill" data-mode="enriched">R√©sonance enrichie</button>
        </div>
        <p class="small">Choisis entre le message brut ou un prompt r√©sonant avant envoi √† Gemma.</p>
      </div>
      <div>
        <label for="poetryLevel">Niveau de po√©tisation</label>
        <input type="range" id="poetryLevel" min="0" max="2" step="1" value="1" />
        <div class="small" id="poetryLabel">L√©ger ‚Äî phrases plus souples</div>
      </div>
    </div>
    <textarea id="msg" placeholder="√âcris ce qui te traverse..."></textarea>
    <div class="row">
      <div>
        <label for="temperature">Temp√©rature</label>
        <input type="number" id="temperature" step="0.1" min="0" max="1" value="0.7" />
      </div>
      <div>
        <label for="top_p">Top P</label>
        <input type="number" id="top_p" step="0.05" min="0" max="1" value="0.9" />
      </div>
      <div>
        <label for="max_tokens">Max tokens</label>
        <input type="number" id="max_tokens" min="32" max="2000" value="256" />
      </div>
    </div>
    <button id="sendBtn">Envoyer</button>
    <button id="resetBtn" style="margin-top:8px; background:#272734;">R√©initialiser</button>
  </section>

  <section class="panel" aria-label="Nuage de mots r√©sonant">
    <div class="panel-header">
      <div>
        <h3>WordCloud r√©sonant</h3>
        <p class="small">Mots regroup√©s par pivot, noyau et p√©riph√©rie (donn√©es /api/echo).</p>
        <p class="small">Stabilit√© ‚Üí opacit√© ¬∑ Delta ‚Üí taille ¬∑ Force lien ‚Üí proximit√©</p>
      </div>
      <span class="badge" id="metaphorBadge">‚Äî</span>
    </div>
    <div id="wordcloud-container" class="wordcloud">
      <div class="orbit orbit-pivot" aria-hidden="true"></div>
      <div class="orbit orbit-noyau" aria-hidden="true"></div>
      <div class="orbit orbit-peripherie" aria-hidden="true"></div>
      <div class="placeholder small">En attente des premiers mots...</div>
    </div>
  </section>

  <section class="panel" aria-label="Graph r√©sonant">
    <div class="panel-header">
      <div>
        <h3>Graph r√©sonant</h3>
        <p class="small">Pivot au centre, noyau en anneau, p√©riph√©rie orbitant. Force des liens ‚Üí √©paisseur.</p>
      </div>
      <span class="badge" id="graphMode">SVG</span>
    </div>
    <div id="graph-container" class="graph-shell">
      <svg id="resonantGraph" viewBox="0 0 640 420" aria-label="Graphique r√©sonant"></svg>
    </div>
  </section>

  <button id="debugToggle" class="ghost-btn" aria-expanded="false">Afficher les d√©tails techniques</button>

  <section class="panel debug-section" aria-label="Analyse r√©sonante brute">
    <h3>Analyse r√©sonante</h3>
    <p class="small">Chaque message est aussi envoy√© √† l'API locale <code>/api/echo</code> pour extraire le pivot, le noyau et la p√©riph√©rie.</p>
    <pre id="echoPanel">En attente d'un premier message...</pre>
  </section>

  <section class="panel debug-section" aria-label="Mod√®le Nebius">
    <h3>Mod√®le Nebius</h3>
    <p class="small" id="nebiusStatus">Nebius non activ√© ‚Äî mode d√©veloppement MOCK</p>
    <pre id="nebiusOutput">R√©ponse simul√©e en attente...</pre>
    <p class="small">POST https://api.tokenfactory.nebius.com/v1/chat/completions</p>
    <p class="small">model: google/gemma-2-2b-it ¬∑ role: system ‚Üí psychologue clinicien bienveillant</p>
  </section>

  <script src="./script.js"></script>
</body>
</html>
